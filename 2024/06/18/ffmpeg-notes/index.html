<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>ffmpeg笔记 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="视频编码,视频,ffmpeg,码率"><meta name="description" content="&lt;h5 id=&#34;合并一个文件夹内的所有视频&#34;&gt;&lt;a href=&#34;#合并一个文件夹内的所有视频&#34; class=&#34;headerlink&#34; title=&#34;合并一个文件夹内的所有视频&#34;&gt;&lt;/a&gt;合并一个文件夹内的所有视频&lt;/h5&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;find *.mp4 | sed &amp;#x27;s:\ :\\\ :g&amp;#x27;| sed &amp;#x27;s/^/file /&amp;#x27; &amp;gt; fl.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;f"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">ffmpeg笔记</h1></div><div class="post-meta"><span class="post-time">2024-06-18</span></div><div class="post-content"><h5 id="合并一个文件夹内的所有视频"><a href="#合并一个文件夹内的所有视频" class="headerlink" title="合并一个文件夹内的所有视频"></a>合并一个文件夹内的所有视频</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find *.mp4 | sed &#x27;s:\ :\\\ :g&#x27;| sed &#x27;s/^/file /&#x27; &gt; fl.txt</span><br><span class="line">ffmpeg -f concat -i fl.txt -c copy output.mp4</span><br><span class="line">// 忽略错误信息</span><br><span class="line">ffmpeg -safe 0 -f concat -i fl.txt -c copy output.mp4</span><br><span class="line">rm fl.txt</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28922352/how-can-i-merge-all-the-videos-in-a-folder-to-make-a-single-video-file-using-ffm">参考资源</a></p><h5 id="视频压缩"><a href="#视频压缩" class="headerlink" title="视频压缩"></a>视频压缩</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 视频使用h.264编码，声音使用aac编码</span><br><span class="line">ffmpeg -i input.mp4 -vcodec h264 -acodec aac output.mp4</span><br><span class="line">// 视频使用h.265编码，压缩到更小文档</span><br><span class="line">ffmpeg -i input.mp4 -vcodec libx265 -crf 28 output.mp4</span><br><span class="line">// 视频使用h.264编码，保留更好的质量</span><br><span class="line">ffmpeg -i input.mp4 -vcodec libx264 -crf 20 output.mp4</span><br></pre></td></tr></table></figure><p>crf越小，视频质量越高；crf越大，视频文件越小</p><p>编码参数也可以简写，从<code>-vcodec</code>和<code>-acodec</code>改为<code>-c:v</code>和<code>-c:a</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -c:v libx264 -crf 23 output.mp4</span><br><span class="line">ffmpeg -i input.mp4 -c:v libx265 -crf 28 output.mp4</span><br><span class="line">ffmpeg -i input.mp4 -c:v libvpx-vp9 -crf 31 -b:v 0 output.mkv</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://slhck.info/video/2017/02/24/crf-guide.html">参考资源</a></p><p>其中<code>AVC/H264</code>和<code>HEVC/H265</code>都是软件编码，速度很慢。可以选择英伟达的硬件编码：hevc_nvenc与h264_nvenc，它们使用硬件加速，速度很快。</p><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/opus/376578377423593855">参考资源</a></p><p>使用英伟达显卡进行编码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i video.mp4 -c:v hevc_nvenc -crf 28 output.mp4</span><br></pre></td></tr></table></figure><p>将视频从H.264转码到H.265，花了55分钟，视频体积从3.8GB减小到430MB，效果立竿见影。转码命令：<code>ffmpeg -i 1.mp4 -c:v libx265 -vtag hvc1 -c:a copy 1_hevc.mp4</code></p><p>在win10可以用scoop安装ffmpeg，更新Windows上面通过scoop安装的所有程序<br><code>scoop list | foreach &#123; scoop update $_.Name &#125;</code>。</p><p>将视频以同样的编码，按照指定时间进行裁剪</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 00:05 -to 08:53.500 -i ./input.mp4 -c copy video.mp4</span><br></pre></td></tr></table></figure><p>利用ffmpeg快速剪辑视频</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 07:18 -to 13:45 -i ./aaa.mkv -c copy bbb.mkv</span><br></pre></td></tr></table></figure><ul><li>-ss表示开始时间</li><li>-to表示结束时间</li><li>-i是输入文档</li><li>-c表示使用被剪辑视频一样的编码</li><li>bbb是输出文档的名称</li></ul><p>合并视频和声音，视频使用原始编码，声音改为aac编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i 1.mp4 -i 1.opus -c:v copy -c:a aac output.mp4</span><br></pre></td></tr></table></figure><p>将PNG格式图片转为JPG格式图片</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i image.png -preset ultrafast image.jpg</span><br></pre></td></tr></table></figure><p>修改图片的尺寸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i image.jpeg -vf scale=413:626 2寸.jpeg</span><br><span class="line">ffmpeg -i image.jpeg -vf scale=390:567 1寸.jpeg</span><br></pre></td></tr></table></figure><p>将一个音频重复10次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -stream_loop 10 -i input.m4a -c copy output.m4a</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="ffmpeg笔记">https://www.nosuchfield.com/2024/06/18/ffmpeg-notes/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E7%A0%81%E7%8E%87/" rel="tag">码率</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E8%A7%86%E9%A2%91/" rel="tag">视频</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81/" rel="tag">视频编码</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>