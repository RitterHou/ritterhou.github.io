<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>如何参与Apache顶级开源项目 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="APISIX,开源,apache"><meta name="description" content="&lt;p&gt;我们在日常工作中经常会使用到很多的开源项目，开源也是一个在工作和学习中都离不开的内容。一般来说，开源项目可以选择直接开源，也可以选择捐赠给某些基金会，例如&lt;a href=&#34;https://www.linuxfoundation.org/&#34;&gt;Linux Foundation&lt;/a&gt;、&lt;a href=&#34;https://www.cncf.io/&#34;&gt;CNCF&lt;/a&gt;和&lt;a href=&#34;https://www.apache.org/&#34;&gt;ASF&lt;/a&gt;等等。以ASF为例，如果一个项目想要成为&lt;a href=&#34;https://projects.apache.org/projects.html&#34;&gt;顶级项目&lt;/a&gt;，则需要先通过&lt;a href=&#34;https://incubator.apache.org/&#34;&gt;孵化器&lt;/a&gt;孵化，孵化结束毕业才能成为顶级项目。最近我因为一些原因参与了云原生网关&lt;a href=&#34;https://apisix.apache.org/&#34;&gt;APISIX&lt;/a&gt;开源项目，这里做一下介绍。&lt;/p&gt;
&lt;h2 id=&#34;搭建环境&#34;&gt;&lt;a href=&#34;#搭建环境&#34; class=&#34;head"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">如何参与Apache顶级开源项目</h1></div><div class="post-meta"><span class="post-time">2024-01-24</span></div><div class="post-content"><p>我们在日常工作中经常会使用到很多的开源项目，开源也是一个在工作和学习中都离不开的内容。一般来说，开源项目可以选择直接开源，也可以选择捐赠给某些基金会，例如<a target="_blank" rel="noopener" href="https://www.linuxfoundation.org/">Linux Foundation</a>、<a target="_blank" rel="noopener" href="https://www.cncf.io/">CNCF</a>和<a target="_blank" rel="noopener" href="https://www.apache.org/">ASF</a>等等。以ASF为例，如果一个项目想要成为<a target="_blank" rel="noopener" href="https://projects.apache.org/projects.html">顶级项目</a>，则需要先通过<a target="_blank" rel="noopener" href="https://incubator.apache.org/">孵化器</a>孵化，孵化结束毕业才能成为顶级项目。最近我因为一些原因参与了云原生网关<a target="_blank" rel="noopener" href="https://apisix.apache.org/">APISIX</a>开源项目，这里做一下介绍。</p><h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><p>首先我们需要下载源代码并且构建开发流程，根据<a target="_blank" rel="noopener" href="https://apisix.apache.org/docs/general/contributor-guide/">官网介绍</a>，我们把项目代码fork到自己的仓库并clone到本地，随后在本地仓库中将原始的项目设置为上游<code>upstream</code>，之后新建分支进行开发即可</p><pre><code>~ git clone git@github.com:RitterHou/apisix.git
~ cd apisix
~ git remote -v
~ git remote add upstream https://github.com/apache/apisix.git
~ git config --global user.name &quot;derobukal&quot;
~ git config --global user.email &quot;derobukal@gmail.com&quot;
~ git fetch upstream
~ git checkout master
~ git rebase upstream/master
~ git push origin master
~ git checkout -b issue-10484
~ cd ..
</code></pre><p>根据<a target="_blank" rel="noopener" href="https://apisix.apache.org/docs/apisix/building-apisix/">官方教程</a>，我们还需要安装APISIX的开发环境<sup>注1</sup></p><pre><code>~ export https_proxy=&quot;http://192.168.65.100:7890&quot;
~ export http_proxy=&quot;http://192.168.65.100:7890&quot;
~ wget https://raw.githubusercontent.com/apache/apisix/master/utils/install-dependencies.sh
~ APISIX_RUNTIME=&#39;1.1.1&#39; bash install-dependencies.sh
~ cd apisix
~ make deps
~ sudo mkdir /usr/local/apisix
~ sudo mkdir /usr/local/apisix/logs
~ sudo chown raymond:raymond /usr/local/apisix -R
~ sudo make install
</code></pre><p>以及安装和启动etcd</p><pre><code>~ ETCD_VERSION=&#39;3.4.18&#39; wget https://github.com/etcd-io/etcd/releases/download/v$&#123;ETCD_VERSION&#125;/etcd-v$&#123;ETCD_VERSION&#125;-linux-amd64.tar.gz &amp;&amp; tar -xvf etcd-v$&#123;ETCD_VERSION&#125;-linux-amd64.tar.gz &amp;&amp; cd etcd-v$&#123;ETCD_VERSION&#125;-linux-amd64 &amp;&amp; sudo cp -a etcd etcdctl /usr/bin/
~ cd ..
~ etcd
</code></pre><h2 id="最简单的PR"><a href="#最简单的PR" class="headerlink" title="最简单的PR"></a>最简单的PR</h2><p>搭建好了环境之后，就可以修改代码并提交PR了。一般来说开源项目都会有多种类型的改动，以apisix为例，它限制了PR可以为<a target="_blank" rel="noopener" href="https://github.com/apache/apisix/blob/master/.github/workflows/semantic.yml">固定的几种类型</a>：</p><pre><code>feat
fix
docs
style
refactor
perf
test
build
ci
chore
revert
change
</code></pre><p>包含了文档修改、新功能、bug修复等等，我们选择比较简单的文档修改作为第一个PR。我在使用APISIX的过程中，发现它<a target="_blank" rel="noopener" href="https://apisix.apache.org/docs/apisix/certificate/">证书相关的文档</a>中存在一个错误</p><p><img src="/images/20240124/1.png"></p><p>在上图中，这里的地址不应该是<code>/hello</code>而应该是<code>/get</code>，因此我们可以在本地仓库新建一个分支并对这个问题作出修改。修改后我们将这次改动提交（为了使提交更加的清晰和安全，建议<a target="_blank" rel="noopener" href="https://crossoverjie.top/2023/09/18/ob/git-tips-rebase/">合并commit并对commit进行签名</a>）并push到我们自己的远程仓库，随后在GitHub上面创建一个针对<a target="_blank" rel="noopener" href="https://github.com/apache/apisix/pull/10790">原始仓库的Pull Request</a>。一般项目在创建一个PR的时候都会有模板信息，照着模板信息进行填写即可，填写完毕就可以提交PR并等待项目的成员进行处理了</p><p><img src="/images/20240124/2.png"></p><h2 id="修复issue中的问题"><a href="#修复issue中的问题" class="headerlink" title="修复issue中的问题"></a>修复issue中的问题</h2><p>在APISIX中有着很多的ISSUE</p><p><img src="/images/20240124/3.png"></p><p>我们可以关注这些ISSUE看有没有自己能解决的问题。一般来说，带有<code>good first issue</code>标签的都是比较简单并且适合新人的，我们可以优先从这些issue中寻找自己能解决的问题</p><p><img src="/images/20240124/4.png"></p><p>在确定了issue之后，我们可以请求管理员将这个issue分配给自己，防止别人也会去解决这个问题从而浪费时间。当然，有的时候issue即使已经被分配给别人了，但是如果他一直没有解决这个问题，我们仍然可以请求将这个issue分配给自己</p><p><img src="/images/20240124/5.png"></p><h2 id="搭建测试环境"><a href="#搭建测试环境" class="headerlink" title="搭建测试环境"></a>搭建测试环境</h2><p>对于<a target="_blank" rel="noopener" href="https://github.com/apache/apisix/issues/10484">issue-10484</a>，因为涉及到代码更改，因此需要执行测试。APISIX使用了<a target="_blank" rel="noopener" href="https://github.com/openresty/test-nginx">test-nginx</a>框架来执行测试，官方有关于如何进行测试的介绍</p><ul><li><a target="_blank" rel="noopener" href="https://apisix.apache.org/docs/apisix/internal/testing-framework/">https://apisix.apache.org/docs/apisix/internal/testing-framework/</a></li><li><a target="_blank" rel="noopener" href="https://apisix.apache.org/blog/2022/06/27/getting-start-with-apisix-test-cases/">https://apisix.apache.org/blog/2022/06/27/getting-start-with-apisix-test-cases/</a></li></ul><p>我们需要安装测试框架<sup>注2</sup></p><pre><code>sudo cpan Test::Nginx
</code></pre><p>并下载依赖测试模块</p><pre><code>➜  apisix git:(issue-10484) git clone https://github.com/api7/test-toolkit/ t/toolkit
</code></pre><p>修改完代码之后可以执行相关的测试</p><pre><code>~ PATH=/usr/local/openresty/nginx/sbin:/usr/bin PERL5LIB=.:$PERL5LIB FLUSH_ETCD=1 prove -Itest-nginx/lib -r t/admin/ssl2.t
t/admin/ssl2.t .. ok    
All tests successful.
Files=1, Tests=52, 11 wallclock secs ( 0.06 usr  0.01 sys +  3.61 cusr  1.05 csys =  4.73 CPU)
Result: PASS
</code></pre><p>如果测试没有问题就可以提交PR了。</p><h2 id="通过CI的测试"><a href="#通过CI的测试" class="headerlink" title="通过CI的测试"></a>通过CI的测试</h2><p>apisix使用GitHub的workflow进行CI执行测试，以<a target="_blank" rel="noopener" href="https://github.com/apache/apisix/blob/master/.github/workflows/redhat-ci.yaml">redhat-ci.yaml</a>为例，它会在多个平台上执行多个文件夹内的测试。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test_apisix:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">run</span> <span class="string">ci</span> <span class="string">on</span> <span class="string">redhat</span> <span class="string">ubi</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">timeout-minutes:</span> <span class="number">90</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">events_module:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">lua-resty-worker-events</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">lua-resty-events</span></span><br><span class="line">        <span class="attr">test_dir:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">t/plugin/[a-k]*</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">t/plugin/[l-z]*</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">t/admin</span> <span class="string">t/cli</span> <span class="string">t/config-center-yaml</span> <span class="string">t/control</span> <span class="string">t/core</span> <span class="string">t/debug</span> <span class="string">t/discovery</span> <span class="string">t/error_page</span> <span class="string">t/misc</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">t/node</span> <span class="string">t/pubsub</span> <span class="string">t/router</span> <span class="string">t/script</span> <span class="string">t/secret</span> <span class="string">t/stream-node</span> <span class="string">t/utils</span> <span class="string">t/xds-library</span></span><br></pre></td></tr></table></figure><p>如上所示，GitHub action中的<a target="_blank" rel="noopener" href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs">matrix</a>默认会对其下面的的多个选项进行合并，例如<code>redhat-ci.yaml</code>的<code>events_module</code>和<code>test_dir</code>组合起来就会构成8个执行脚本</p><pre><code>lua-resty-worker-events t/plugin/[a-k]*
lua-resty-worker-events t/plugin/[l-z]*
lua-resty-worker-events t/admin t/cli t/config-center-yaml t/control t/core t/debug t/discovery t/error_page t/misc
lua-resty-worker-events t/node t/pubsub t/router t/script t/secret t/stream-node t/utils t/xds-library
lua-resty-events t/plugin/[a-k]*
lua-resty-events t/plugin/[l-z]*
lua-resty-events t/admin t/cli t/config-center-yaml t/control t/core t/debug t/discovery t/error_page t/misc
lua-resty-events t/node t/pubsub t/router t/script t/secret t/stream-node t/utils t/xds-library
</code></pre><p>github的CI会对这些所有的任务执行测试。如果测试执行失败了，需要重点关注失败的日志，并在本地调试直到可以通过测试。如果遇到数据不对的问题，可以重新对数据进行初始化</p><pre><code>apisix quit &amp;&amp; apisix init &amp;&amp; apisix init_etcd &amp;&amp; apisix start
</code></pre><h2 id="社区交流"><a href="#社区交流" class="headerlink" title="社区交流"></a>社区交流</h2><p>在代码提交并创建了PR之后，我们可能会收到一些反馈，这时候我们就需要针对这些反馈作出回应。以<a target="_blank" rel="noopener" href="https://github.com/apache/apisix/pull/10771">#10771</a>为例</p><p><img src="/images/20240124/6.png"></p><p>我在提交了代码之后，管理员认为需要将<code>aes_encrypt_pkey</code>和<code>aes_decrypt_pkey</code>方法中的<code>field</code>字段去掉。我一开始在写代码的时候就发现这个字段去掉会导致数据加解密过程中<code>ssl</code>和<code>data</code>的行为不一致，可能导致错误。不过管理员让我放心删，没问题，本着信任的态度我就把参数删除掉了</p><p><img src="/images/20240124/7.png"></p><p>但是删除掉了之后测试却怎么也跑不过，我因为非常信任社区管理员也没有怀疑是因为<code>ssl</code>和<code>data</code>逻辑不一致导致的，而是从其它地方入手进行排查。最终花了大量的时间经过了很多**的排查之后，发现其实就是因为<code>ssl</code>和<code>data</code>的行为逻辑不一致导致的。我随后询问了管理员，并且把<code>field</code>参数加了回来</p><p><img src="/images/20240124/8.png"></p><p>把<code>field</code>参数加回来之后，所有的test cases就都能跑过了</p><p><img src="/images/20240124/9.png"></p><p>所有测试用例通过，一段时间之后PR被review没有问题，就会被合并到master分支了</p><p><img src="/images/20240124/10.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=jw8K460vx1c">Revolution OS</a><br><a target="_blank" rel="noopener" href="https://www.xiaoyuzhoufm.com/episode/651fb7082e5a4700d96ccc71">S04E00-吴晟：开源项目进入 Apache 孵化器意味着什么</a><br><a target="_blank" rel="noopener" href="https://opensourceway.community/posts/foundation_introduce/how_apache_works/">Apache 是如何运作的？</a><br><a target="_blank" rel="noopener" href="https://crossoverjie.top/2023/08/05/ob/novice-contribute-open-source/">新手如何快速参与开源项目</a><br><a target="_blank" rel="noopener" href="https://wuchong.me/blog/2019/02/12/how-to-become-apache-committer/">如何从小白成长为 Apache Committer?</a></p><h1 id="注"><a href="#注" class="headerlink" title="注"></a>注</h1><ol><li><p>在执行<code>install-dependencies.sh</code>脚本的时候，会下载golang的依赖，比如<a target="_blank" rel="noopener" href="https://github.com/grpc/grpc-go">gRPC-Go</a>，这里需要保证网络能够顺畅访问golang的官方仓库。</p></li><li><p>为了保证test-nginx正常安装，需要网络顺畅，能够正常访问相关资源。</p></li></ol></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="如何参与Apache顶级开源项目">https://www.nosuchfield.com/2024/01/24/How-to-Participate-in-Apache-Top-Level-Projects/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/APISIX/" rel="tag">APISIX</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E5%BC%80%E6%BA%90/" rel="tag">开源</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>