<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>使用 Docker 来构建一个 Tomcat 服务 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="JavaWeb,容器"><meta name="description" content="&lt;p&gt;&lt;a href=&#34;https://www.docker.com/&#34;&gt;Docker&lt;/a&gt; 作为一种轻量级的虚拟机技术，目前已经得到了广泛的应用。Docker 能够把你从繁琐的项目配置中拯救出来，并且提高项目的统一性，开发人员在开发好了项目之后，完全可以把项目打包成为一个 Docker 镜像，然后把其交给运维即可。&lt;/p&gt;
&lt;h3 id=&#34;1-安装-Docker&#34;&gt;&lt;a href=&#34;#1-安装-Docker&#34; class=&#34;headerlink&#34; title=&#34;1. 安装 Docker&#34;&gt;&lt;/a&gt;1. 安装 Docker&lt;/h3&gt;&lt;p&gt;如果你是在 Ubuntu 上（需要 64 位操作系统），只需要一行命令就可以搞定&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get install docker.io
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时可以运行以下命令来查看 Docker 的相关信息&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker info
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在其它的操作系统上安装 Docker 可以参考&lt;a href=&#34;https://www.docker.c"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">使用 Docker 来构建一个 Tomcat 服务</h1></div><div class="post-meta"><span class="post-time">2016-10-11</span></div><div class="post-content"><p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> 作为一种轻量级的虚拟机技术，目前已经得到了广泛的应用。Docker 能够把你从繁琐的项目配置中拯救出来，并且提高项目的统一性，开发人员在开发好了项目之后，完全可以把项目打包成为一个 Docker 镜像，然后把其交给运维即可。</p><h3 id="1-安装-Docker"><a href="#1-安装-Docker" class="headerlink" title="1. 安装 Docker"></a>1. 安装 Docker</h3><p>如果你是在 Ubuntu 上（需要 64 位操作系统），只需要一行命令就可以搞定</p><pre><code>sudo apt-get install docker.io
</code></pre><p>此时可以运行以下命令来查看 Docker 的相关信息</p><pre><code>docker info
</code></pre><p>在其它的操作系统上安装 Docker 可以参考<a target="_blank" rel="noopener" href="https://www.docker.com/products/docker">官方文档</a>。</p><h3 id="2-理解容器"><a href="#2-理解容器" class="headerlink" title="2. 理解容器"></a>2. 理解容器</h3><p>容器就是我们在 Docker 中运行服务的地方，一个宿主机上可以运行着多个容器，他们可以分别包含着不同的服务。</p><p>例如，我们现在运行着三个容器，分别运行了 MySQL、Tomcat 和 Nginx（不同的服务其实是可以运行在同一个容器中的，但是我们一般还是建议不同的服务应该运行在不同的容器中）这三个服务，那么我们就好像拥有了三台不同的物理机一样，这三台机器是相互独立的，你可以把其想象成三台运行着服务的真正的机器。Docker 提供了三台机器间互相通信的方式，但在这里我们不会做过多的涉及，因为这一次我们只会构建一个容器。</p><p>想要查看当前主机上运行着的容器，可以使用命令</p><pre><code>docker ps
</code></pre><p>想要查看当前主机上所有（包括已停止）的容器，使用命令</p><pre><code>docker ps -a
</code></pre><p>目前我们还启动任何容器，所以列表为空。</p><h3 id="3-理解镜像"><a href="#3-理解镜像" class="headerlink" title="3. 理解镜像"></a>3. 理解镜像</h3><p>上面已经讲到了容器的概念，镜像其实就是由容器生成的一种只读的文件。</p><p>打个比方，小 A 自己花了三个小时，手动构建了一个容器，小 A 感到很高兴。此时小 A 的同事小 B 也想要用小 A 的这个容器，该怎么办呢？此时小 A 可以通过以下命令把他自己构建的容器打包成为一个镜像</p><pre><code>docker commit -m &quot;Build a image&quot; &lt;容器ID&gt; &lt;镜像名称&gt;
</code></pre><p>-m 就是构建镜像的时候提交的相关信息，这里的-m是可选项。容器 ID 就是容器的唯一的标识，在显示容器列表的时候可以查看到，而镜像名称就是你想给自己镜像所取的名字，这里镜像名字也是有一套规则的，但是本着简单起见，本文不做涉及，读者有兴趣可自行查阅。</p><p>Docker 提供了以下几种方式来获得&#x2F;创建一个镜像：</p><ol><li>直接从外部仓库中 pull 别人已经做好的镜像；</li><li>自己手动的构建好一个容器，然后然后把其 commit 为一个镜像（就是上面提到的那种方式）；</li><li>通过 Dockerfile 来以文本的方式记录下你创建一个容器的过程，别人可以直接用这个文件来生成对应的镜像；</li><li><del>关于 docker-compose.yml，其作用就是对多个 Dockerfile 进行处理，即处理包含有多个镜像的过程；</del></li></ol><p>其中方式 1 和方式 3 使用的较多，如果想要获取一个别人已经制作好的镜像，可选择方式 1，如果想要自定义一个镜像，一般选择方式 3。</p><h3 id="4-从外部仓库获取一个镜像"><a href="#4-从外部仓库获取一个镜像" class="headerlink" title="4. 从外部仓库获取一个镜像"></a>4. 从外部仓库获取一个镜像</h3><p>上面介绍了一点容器和镜像的基础知识，想必你已经能够大概的明白容器和镜像的概念了，下面我就来获取我们的第一个镜像，这里我们就以 Tomcat 镜像为例。执行以下命令</p><pre><code>docker pull hub.c.163.com/public/tomcat:7.0.28
</code></pre><ul><li>关于中央仓库： Docker 中的中央仓库就是存放了大量的 Docker 镜像的地方，如果你用过 Maven 或者 Python 的 pip 命令，那么你对这种概念一定不会陌生，全球最大的中央仓库是 Docker 官方的<a target="_blank" rel="noopener" href="https://hub.docker.com/">docker hub</a>。不过在这里我使用的是网易蜂巢的 Docker 镜像服务，其服务器在国内，速度也会更快一点。</li></ul><p>上面的命令会执行一系列的下载操作，执行完毕之后，如果不出错，那么你已经获取到了一个 Tomcat 的镜像。此时执行命令</p><pre><code>sudo docker images
</code></pre><p>将会列出所有的镜像列表，我的镜像列表如下所示</p><p><img src="/images/20161011/20161011215902.png"></p><p>可以看到，这是一个从 163 仓库下载下来的镜像，并且他的名字是十分有规律的。至此，我们已经成功得从远程仓库获取了一个 Tomcat 镜像，下面我会讲如何启动这个镜像使其成为一个容器并运行。</p><h5 id="关于-Dockerfile"><a href="#关于-Dockerfile" class="headerlink" title="关于 Dockerfile"></a>关于 Dockerfile</h5><p>Dockerfile 也是一种创建镜像的及其常用并且也是非常重要的方式，有些时候可能会是唯一的方式（比如在使用 <a target="_blank" rel="noopener" href="https://www.daocloud.io/">Daocloud</a> 服务的时候）。</p><p>我们可以手动书写一个 Dockerfile 文件，然后</p><ul><li>通过 EXPOSE 来开放镜像端口；</li><li>通过 COPY 来复制宿主机文件到镜像中的指定位置；</li><li>其他的一些命令；</li><li>最后，根据 Dockerfile 文件创建一个名为image-name的镜像：<code>docker build -t image-name .</code>。</li></ul><p>关于 Dockerfile 的内容也非常多，在这里我们不会更多的涉及，有兴趣的读者可自行查阅相关资料学习。</p><h3 id="5-通过镜像来启动一个容器"><a href="#5-通过镜像来启动一个容器" class="headerlink" title="5. 通过镜像来启动一个容器"></a>5. 通过镜像来启动一个容器</h3><p>通过上面的步骤，我们已经成功的拥有了一个 Tomcat 的镜像，接下来，是时候把他启动起来了。执行命令</p><pre><code>docker run --name tomcat -d -p 80:8080 8e17306cf050
</code></pre><ul><li><code>run</code> 表示要通过一个镜像启动一个容器；</li><li><code>--name tomcat</code> 是给这个启动的容器起了个名字，名字是 tomcat。如果不加此项，Docker 会自动给这个容器起一个名字；</li><li><code>-d</code> 表示此容器会以守护进程（daemon）的方式来执行。如果想要以命令行的方式来执行，可以使用 <code>-it</code> 选项，并且需要在最后加上bash命令，即：<br>docker run –name tomcat -it -p 80:8080 8e17306cf050 bash</li></ul><p>事实上，更加一般的做法是先以守护进程的方式启动容器，之后通过命令<br>docker exec -it 8e17306cf050 bash<br>来进入容器的bash，我比较推荐使用第二种做法<sup><a target="_blank" rel="noopener" href="https://github.com/ma6174/blog/issues/8#issuecomment-59601872">注</a></sup>；</p><ul><li><code>-p 80:8080</code> 表示把当前宿主机的 80 端口映射到容器的 8080 端口；</li><li><code>8e17306cf050</code> 就是上面的 Tomcat 镜像的 ID，通过 <code>docker images</code> 可以查看到，表示我们想要启动的容器是对应于这个镜像的。</li></ul><p>启动完毕后，在浏览器中打开<code>http://127.0.0.1/</code>，应该能够看到如下内容，表示容器已成功启动，并且对应的 Tomcat 服务已经在正常运行。</p><p><img src="/images/20161011/20161011222403.png"></p><p>之后，执行以下命令显示所有正在运行的容器</p><pre><code>docker ps
</code></pre><p>我们可以查看到正在运行的名称叫做 tomcat 的容器，并且可以查看到它的容器 ID。</p><p>为了后面的操作能够顺利进行，我们需要先执行 <code>docker stop &lt;容器ID&gt;</code> 和 <code>docker rm &lt;容器ID&gt;</code> 来停止并删除这个容器。</p><p>如上图所示，在这里我们只能显示 Tomcat 的初始网页，怎么样才能让容器运行我们自己所写的代码呢？观察之前在浏览器中所所打开的页面，其中有一行</p><pre><code>This is the default Tomcat home page. It can be found on the local filesystem at: /var/lib/tomcat7/webapps/ROOT/index.html
</code></pre><p>也就是说 <code>/var/lib/tomcat7/webapps/ROOT/</code> 就是项目的根目录，我们只需要把自己的 Java 项目放到这个文件夹下就能执行我们自己的代码了。那么要怎么做？执行命令</p><pre><code>docker run --name tomcat -d -p 80:8080 -v /home/derobukal/Desktop/html:/var/lib/tomcat7/webapps/ROOT/ 8e17306cf050 
</code></pre><p>这条启动容器的命令和上面的相比多了个 <code>-v /home/derobukal/Desktop/html:/var/lib/tomcat7/webapps/ROOT/</code>，表示把当前文件夹的 <code>/home/derobukal/Desktop/html</code> 目录（必须是绝对路径）挂载到 <code>/var/lib/tomcat7/webapps/ROOT/</code> 上，此时对文件夹 <code>html</code> 的操作就相当于在操作容器中 tomcat 下的 ROOT 文件夹。我们在 <code>html</code> 文件夹下新建一个文件，命名为<code>index.html</code>，在之中输入<code>hello, world</code>，然后刷新浏览器页面，显示结果如下</p><p><img src="/images/20161011/20161011225743.png"></p><p>至此我们已经可以成功的部署 Tomcat 应用了。</p><p>如果你需要重启 Tomcat，可以执行命令</p><pre><code>docker restart &lt;容器ID&gt;
</code></pre><p>可以通过以下命令来删除一个 Docker 镜像</p><pre><code>docker rmi &lt;镜像ID&gt;
</code></pre><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>在 Docker 中需要清晰的区分镜像和容器的概念，并且要明白他们所对应的操作有什么不同。如果能理解了他们之中的差异，那么也就能够快速的理解 Docker 的相关操作了。</p><p>本文只是对 Docker 进行了一个简单的介绍，想要了解更多关于 Docker 的内容，读者可以参阅 <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/yeasy/docker_practice/details">Docker 技术入门与实战</a> 一书，这里介绍了关于 Docker 的大量细节，如果你想要更加深入的了解 Docker，那么你一定不能错过这本书籍。</p><h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ol><li><a target="_blank" rel="noopener" href="http://blog.saymagic.cn/2015/06/01/learning-docker.html">Docker简明教程</a></li><li><a target="_blank" rel="noopener" href="http://blog.csdn.net/achilles12345/article/details/47159043">如何在docker中部署tomcat,并且部署java应用程序</a></li></ol></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="使用 Docker 来构建一个 Tomcat 服务">https://www.nosuchfield.com/2016/10/11/build-a-tomcat-service-by-docker/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag">容器</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>