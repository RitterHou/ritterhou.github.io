<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>利用whisper为视频自动生成字幕 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="自然语言处理,机器学习"><meta name="description" content="&lt;p&gt;&lt;a href=&#34;https://github.com/openai/whisper&#34;&gt;whisper&lt;/a&gt;是一个由openai开发的通用语言识别模型，我们可以使用它来为视频自动创建字幕。&lt;/p&gt;
&lt;h2 id=&#34;环境安装&#34;&gt;&lt;a href=&#34;#环境安装&#34; class=&#34;headerlink&#34; title=&#34;环境安装&#34;&gt;&lt;/a&gt;环境安装&lt;/h2&gt;&lt;p&gt;为了加速，我们需要使用GPU来进行计算，因此需要安装基于CUDA的pytorch。首先我们需要安装&lt;a href=&#34;https://docs.anaconda.com/miniconda/install/&#34;&gt;Miniconda&lt;/a&gt;，这里安装的时候直接点击下一步即可。&lt;/p&gt;
&lt;p&gt;安装完毕之后，我们需要创建一个新的环境，这里我们创建一个名为&lt;code&gt;whisper&lt;/code&gt;的环境：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;conda create -n whisper python=3.8
conda activate whisper
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;1-安装CUDA&#34;&gt;&lt;a href=&#34;#1-安装CU"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">利用whisper为视频自动生成字幕</h1></div><div class="post-meta"><span class="post-time">2025-01-02</span></div><div class="post-content"><p><a target="_blank" rel="noopener" href="https://github.com/openai/whisper">whisper</a>是一个由openai开发的通用语言识别模型，我们可以使用它来为视频自动创建字幕。</p><h2 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2><p>为了加速，我们需要使用GPU来进行计算，因此需要安装基于CUDA的pytorch。首先我们需要安装<a target="_blank" rel="noopener" href="https://docs.anaconda.com/miniconda/install/">Miniconda</a>，这里安装的时候直接点击下一步即可。</p><p>安装完毕之后，我们需要创建一个新的环境，这里我们创建一个名为<code>whisper</code>的环境：</p><pre><code>conda create -n whisper python=3.8
conda activate whisper
</code></pre><h3 id="1-安装CUDA"><a href="#1-安装CUDA" class="headerlink" title="1. 安装CUDA"></a>1. 安装CUDA</h3><p>安装好了Miniconda之后，我们需要安装CUDA，执行<code>nvidia-smi</code></p><pre><code>$ nvidia-smi
Thu Jan  2 11:49:53 2025
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 560.94                 Driver Version: 560.94         CUDA Version: 12.6     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                  Driver-Model | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce GTX 1060 6GB  WDDM  |   00000000:01:00.0  On |                  N/A |
|  0%   39C    P8             10W /  120W |     505MiB /   6144MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
</code></pre><p>通过这个命令可以看到<code>Driver Version: 560.94</code>和<code>CUDA Version: 12.6</code>，因此我们需要安装12.6版本的CUDA，更加详细的版本对照表在<a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html">这里</a>。在安装的时候可以选择<strong>自定义</strong>安装选项，一般来说只要勾选CUDA下的 Development和Runtime即可。</p><p>安装完毕之后执行命令<code>nvcc -V</code>查看CUDA版本：</p><pre><code>$ nvcc -V
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2024 NVIDIA Corporation
Built on Thu_Sep_12_02:55:00_Pacific_Daylight_Time_2024
Cuda compilation tools, release 12.6, V12.6.77
Build cuda_12.6.r12.6/compiler.34841621_0
</code></pre><h3 id="2-安装cuDNN"><a href="#2-安装cuDNN" class="headerlink" title="2. 安装cuDNN"></a>2. 安装cuDNN</h3><p>根据自己下载的CUDA来选择对应版本的cuDNN，下载地址在<a target="_blank" rel="noopener" href="https://developer.nvidia.com/rdp/cudnn-download">这里</a>。下载完毕之后解压到CUDA的安装目录下，一般来说是<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA&#123;版本号&#125;</code>，如果有重名的文件直接替换即可。</p><p>之后进入<code>extras\demo_suite</code>目录，执行如下命令：</p><pre><code>bandwidthTest.exe
deviceQuery.exe
</code></pre><p>如果出现了PASS的字样，说明安装成功。</p><h3 id="3-安装pytorch"><a href="#3-安装pytorch" class="headerlink" title="3. 安装pytorch"></a>3. 安装pytorch</h3><p>切换到我们之前创建的<code>whisper</code>环境，使用如下命令安装CUDA版本的pytorch：</p><pre><code>pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
</code></pre><p>安装之后执行python命令进入python环境，执行如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">torch.cuda.is_available()</span><br></pre></td></tr></table></figure><p>如果显示True则说明CUDA版本的pytorch安装成功。</p><h3 id="4-安装whisper"><a href="#4-安装whisper" class="headerlink" title="4. 安装whisper"></a>4. 安装whisper</h3><p>切换到我们之前创建的<code>whisper</code>环境，执行如下命令安装whisper：</p><pre><code>pip install -U openai-whisper
pip install setuptools-rust
</code></pre><p>安装完毕之后执行如下命令就可以使用whisper了：</p><pre><code>whisper &#39;C:/Users/raymond/Desktop/voice.aac&#39; --language zh --model turbo
</code></pre><p>如上命令表示对<code>C:/Users/raymond/Desktop/voice.aac</code>文件进行中文语言的识别，使用turbo模型。第一次执行该命令会下载模型文件，模型文件较大，下载时请确保网络通畅。执行结果如下</p><pre><code>[00:00.000 --&gt; 00:03.060] 提到肉毒毒素
[00:03.060 --&gt; 00:04.540] 你会想到什么
[00:04.540 --&gt; 00:10.820] 你真的了解它吗
[00:10.820 --&gt; 00:12.540] 2017年
[00:12.540 --&gt; 00:14.180] 肉毒毒素以万能药标签
[00:14.180 --&gt; 00:15.500] 登上时代周刊方面
[00:15.500 --&gt; 00:17.280] 目前它在全球
[00:17.280 --&gt; 00:18.960] 已被应用于几十种适应症
[00:18.960 --&gt; 00:20.560] 仅在2019年
[00:20.560 --&gt; 00:23.000] 接受注射的就已超过620万例
[00:23.000 --&gt; 00:24.880] 但不要忘了
[00:24.880 --&gt; 00:26.780] 肉毒毒素更是一种神经毒素
[00:26.780 --&gt; 00:29.000] 还曾被当作生化武器使用
... 省略 ...
</code></pre><h2 id="生成字幕"><a href="#生成字幕" class="headerlink" title="生成字幕"></a>生成字幕</h2><p>我们可以使用ffmpeg将音频从视频中提取出来，然后使用whisper生成字幕，最后使用ffmpeg将字幕添加到视频中。</p><p>使用如下命令提取音频：</p><pre><code>ffmpeg -i input.mp4 -vn -acodec copy output.aac
</code></pre><p>然后使用whisper生成字幕，我们先在pycharm中创建一个<code>test-whisper</code>项目，并且把python解释器设置为Miniconda创建的<code>whisper</code>环境。创建一个<code>main.py</code>文件，写入如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> whisper</span><br><span class="line"><span class="keyword">from</span> whisper.utils <span class="keyword">import</span> get_writer</span><br><span class="line"></span><br><span class="line">root = <span class="string">&#x27;E:/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用turbo模型</span></span><br><span class="line">model = whisper.load_model(<span class="string">&#x27;turbo&#x27;</span>)</span><br><span class="line">prompt = <span class="string">&#x27;如果使用了中文，请使用简体中文来表示文本内容&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择声音文件，识别中文，并且打印详细信息</span></span><br><span class="line">result = model.transcribe(root + <span class="string">&#x27;output.aac&#x27;</span>, language=<span class="string">&#x27;zh&#x27;</span>, initial_prompt=prompt, verbose=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&#x27;text&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存字幕文件</span></span><br><span class="line">writer = get_writer(<span class="string">&#x27;srt&#x27;</span>, root)</span><br><span class="line">writer(result, <span class="string">&#x27;output.srt&#x27;</span>)</span><br></pre></td></tr></table></figure><p>如上代码表示使用turbo模型，识别中文，打印详细信息，并且保存字幕文件。执行完毕之后我们可以在<code>E:/</code>目录下看到生成的字幕文件。</p><p>最后我们使用ffmpeg将字幕添加到视频中：</p><pre><code>ffmpeg -i input.mp4 -i output.srt -c:s mov_text -c:v copy -c:a copy output.mp4
</code></pre><p>之后我们在播放这个视频的时候就会有字幕了。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://github.com/YaoFANGUK/video-subtitle-generator">video-subtitle-generator</a><br><a target="_blank" rel="noopener" href="https://github.com/1067561191/pytorch_install_tutorial">基于Anaconda的pytorch-cuda</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zijie1024/articles/18375637">CUDA与cuDNN的安装与配置</a><br><a target="_blank" rel="noopener" href="https://gist.github.com/RitterHou/9a7a26dae76cd71a5ece39a56dc85dd7">ffmpeg视频合并、格式转换、截图</a></p></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="利用whisper为视频自动生成字幕">https://www.nosuchfield.com/2025/01/02/Automatically-generate-subtitles-for-videos-with-whisper/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/" rel="tag">自然语言处理</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>