<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>HBase集群的搭建和使用 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="大数据,分布式系统,数据库"><meta name="description" content="&lt;p&gt;HBase是一个分布式的列族数据库，我们可以简单的将其看成一个kv数据库，每个[列 + rowkey + 时间戳]对应了一个单元格。&lt;/p&gt;
&lt;h3 id=&#34;下载HBase的压缩包并解压&#34;&gt;&lt;a href=&#34;#下载HBase的压缩包并解压&#34; class=&#34;headerlink&#34; title=&#34;下载HBase的压缩包并解压&#34;&gt;&lt;/a&gt;下载HBase的压缩包并解压&lt;/h3&gt;&lt;p&gt;我们有三台机器，预计它们的角色将会如下&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Node Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Master&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;RegionServer&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;172.19.65.196&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;yes&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;172.19.72.108&lt;/td&gt;
&lt;td al"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">HBase集群的搭建和使用</h1></div><div class="post-meta"><span class="post-time">2021-04-15</span></div><div class="post-content"><p>HBase是一个分布式的列族数据库，我们可以简单的将其看成一个kv数据库，每个[列 + rowkey + 时间戳]对应了一个单元格。</p><h3 id="下载HBase的压缩包并解压"><a href="#下载HBase的压缩包并解压" class="headerlink" title="下载HBase的压缩包并解压"></a>下载HBase的压缩包并解压</h3><p>我们有三台机器，预计它们的角色将会如下</p><table><thead><tr><th align="left">Node Name</th><th align="left">Master</th><th align="left">RegionServer</th></tr></thead><tbody><tr><td align="left">172.19.65.196</td><td align="left">yes</td><td align="left">no</td></tr><tr><td align="left">172.19.72.108</td><td align="left">backup</td><td align="left">yes</td></tr><tr><td align="left">172.19.72.112</td><td align="left">no</td><td align="left">yes</td></tr></tbody></table><p>在官网下载HBase的压缩包并分发到三台机器上，然后解压压缩包。</p><h3 id="设置免密登录"><a href="#设置免密登录" class="headerlink" title="设置免密登录"></a>设置免密登录</h3><p>学习我们在<a href="/2021/04/12/Installation-and-use-of-HDFS/">HDFS的安装和使用</a>中了解到的SSH免密登录的方法，设置<strong>196</strong>和<strong>108</strong>两台机器要能够<strong>免密访问所有的机器</strong>。</p><h3 id="搭建HDFS和ZooKeeper服务"><a href="#搭建HDFS和ZooKeeper服务" class="headerlink" title="搭建HDFS和ZooKeeper服务"></a>搭建HDFS和ZooKeeper服务</h3><p>根据文章<a href="/2021/04/12/Installation-and-use-of-HDFS/">HDFS的安装和使用</a>和<a href="/2021/04/15/A-brief-introduction-to-ZooKeeper/">ZooKeeper的简单介绍</a>中所介绍的内容，搭建HDFS和ZooKeeper服务。</p><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>修改master机器(196)的<code>./hbase-2.4.11/conf/hbase-site.xml</code>配置文件，设置配置如下（其它配置需要删除，只保留如下配置）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置hbase的搭建方式为分布式集群模式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置hdfs的地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://172.19.65.196:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置ZooKeeper的地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>172.19.65.196:2181,172.19.72.108:2181,172.19.72.112:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改master节点的<code>conf/regionservers</code>文件如下</p><pre><code>172.19.72.108
172.19.72.112
</code></pre><p>在master节点添加文件<code>conf/backup-masters</code>，把master-backup主机的地址也就是<code>172.19.72.108</code>设置到该文件中。</p><p>修改master节点<code>conf/hbase-env.sh</code>文件，添加如下配置让HBase不要启动它自己的ZooKeeper（而是使用我们已经搭建好的ZooKeeper）</p><pre><code>export HBASE_MANAGES_ZK=false
</code></pre><p>随后把conf文件夹的内容同步另外两台机器</p><pre><code>rsync -azvP conf hbase@172.19.72.108:/home/hbase/hbase-2.4.11
rsync -azvP conf hbase@172.19.72.112:/home/hbase/hbase-2.4.11
</code></pre><p>在三台机器的<code>/etc/hosts</code>文件中添加如下配置（可能需要root用户权限）</p><pre><code>172.19.65.196   lin-65-196.localdomain lin-65-196
172.19.72.108   lin-72-108.localdomain lin-72-108
172.19.72.112   lin-72-112-auto-5.localdomain lin-72-112-auto-5
</code></pre><h3 id="启动HBase"><a href="#启动HBase" class="headerlink" title="启动HBase"></a>启动HBase</h3><p>配置文件设置完毕之后在master节点使用如下命令启动HBase</p><pre><code>./bin/start-hbase.sh
</code></pre><p>之后在三台机器上面执行jps命令查看进程</p><pre><code>[hbase@lin-65-196 hbase-2.4.11]$ jps
3618 HMaster                # HBase的mater进程
3027 NameNode               # HDFS的master进程
3899 Jps
3260 SecondaryNameNode      # HDFS的master备用进程
3406 QuorumPeerMain         # ZK进程

[hbase@lin-72-108 ~]$ jps
4262 HRegionServer          # HBase的数据进程
4646 Jps
4073 QuorumPeerMain         # ZK进程
4378 HMaster                # HBase的master备用进程
3982 DataNode               # HDFS的数据进程

[hbase@lin-72-112-auto-5 ~]$ jps
3096 QuorumPeerMain         # ZK进程
3480 Jps
3276 HRegionServer          # HBase的数据进程
3005 DataNode               # HDFS的数据进程
</code></pre><p>访问<a target="_blank" rel="noopener" href="http://172.19.65.196:16010/">http://172.19.65.196:16010</a>查看HBase的master节点信息，访问<a target="_blank" rel="noopener" href="http://172.19.72.112:16030/">http://172.19.72.112:16030</a>查看HBase的数据节点信息。</p><h3 id="HBase的使用"><a href="#HBase的使用" class="headerlink" title="HBase的使用"></a>HBase的使用</h3><p>在一台新的机器上使用同样的HBase，在<code>conf/hbase-site.xml</code>中设置好ZK的地址</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>172.19.65.196:2181,172.19.72.108:2181,172.19.72.112:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>之后使用<code>./bin/hbase shell</code>就可以进入HBase的交互式shell，我们可以执行<code>help</code>查询帮助信息，执行<code>status</code>查看HBase的集群信息</p><pre><code>hbase:001:0&gt; status
1 active master, 1 backup masters, 2 servers, 0 dead, 1.0000 average load
Took 2.1464 seconds
</code></pre><p>随后我们创建表（Table）user，同时设置三个列族（Column Family）address、social_media和info</p><pre><code>create &#39;user&#39;, &#39;address&#39;, &#39;social_media&#39;, &#39;info&#39;
describe &#39;user&#39;
</code></pre><p>随后我们写入两行（Row）数据，行键（Row Key）分别为Zhangsan和Lisi，数据中通过<code>列族（Column Family）:列标识（Column Qualifier）</code>的方式构成了一个列的识别。而<strong>表（Table） + 行键（Row Key） + 列族（Column Family） + 列标识（Column Qualifier）</strong>唯一定位了一个<strong>单元格（Cell）</strong>，这个单元格就是我们保存最终数据的地方。</p><pre><code>put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;address:province&#39;, &#39;Jiangsu&#39;
put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;address:city&#39;, &#39;Nanjing&#39;
put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;social_media:email&#39;, &#39;zhangsan@gmail.com&#39;
put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;social_media:facebook&#39;, &#39;zhangsan123&#39;
put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;info:birthday&#39;, &#39;1998-06-20&#39;
put &#39;user&#39;, &#39;Zhangsan&#39;, &#39;info:degree&#39;, &#39;bachelor&#39;

put &#39;user&#39;, &#39;Lisi&#39;, &#39;address:province&#39;, &#39;Zhejiang&#39;
put &#39;user&#39;, &#39;Lisi&#39;, &#39;address:city&#39;, &#39;Hangzhou&#39;
put &#39;user&#39;, &#39;Lisi&#39;, &#39;social_media:email&#39;, &#39;lisi@163.com&#39;
put &#39;user&#39;, &#39;Lisi&#39;, &#39;social_media:facebook&#39;, &#39;lisi666&#39;
put &#39;user&#39;, &#39;Lisi&#39;, &#39;info:birthday&#39;, &#39;1999-02-15&#39;
put &#39;user&#39;, &#39;Lisi&#39;, &#39;info:degree&#39;, &#39;master&#39;
</code></pre><p>一个单元格中的数据又可以通过<strong>时间戳（Timestap）</strong>来区分为多个版本，读数据时不指定时间戳就会默认读取最新的cell数据，写数据时不指定时间戳就会使用当前时间进行写入，每一个列族都可以独立设置自己的版本数量，默认为3个。</p><p>接下来可以使用命令<code>scan &#39;user&#39;</code>查询所有保存的数据，也可以使用<code>get</code>命令查询单条数据</p><pre><code>hbase:001:0&gt; get &#39;user&#39;, &#39;Lisi&#39;
COLUMN                                 CELL
address:city                          timestamp=2021-04-18T14:48:51.680, value=Hangzhou
address:province                      timestamp=2021-04-18T14:48:38.708, value=Zhejiang
info:birthday                         timestamp=2021-04-18T14:49:51.524, value=1999-02-15
info:degree                           timestamp=2021-04-18T14:50:09.692, value=master
social_media:email                    timestamp=2021-04-18T14:49:15.290, value=lisi@163.com
social_media:facebook                 timestamp=2021-04-18T14:49:28.690, value=lisi666
1 row(s)
Took 0.0750 seconds
</code></pre><h3 id="一些优化技巧"><a href="#一些优化技巧" class="headerlink" title="一些优化技巧"></a>一些优化技巧</h3><ul><li>HBase的数据是按照RowKey的字典顺序存储的，所以为了防止大量的数据被存储在少量的RegionServer中，可以给RowKey加上不同的前缀字符串来进行特定排序；也可以对行键进行Hash算法来保证其值分布的均匀。</li><li>尽量缩短列族和列标识的长度，缩短行键的长度，使用字节模式替代字符串模式保存数据。</li><li>region最大的阈值取值建议在8GB到50GB之间，不宜过小或过大。</li><li>单个cell不超过10MB，如果超过10MB，请使用mob，若再大可以直接存在HDFS中，在HBase内存储HDFS地址。</li><li>列簇数量不建议过多，一般1个即可，不建议超过3个。</li><li>对于时序场景，建议rowkey设计为设备ID加上时间，如果采用“时间+设备ID”的方案会导致如下：<ul><li>同一时间点的数据落入同一个region，导致热点。</li><li>较早数据随着时间推移、数据过期会留下大量的空地域，带来不必要的开销。</li></ul></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#quickstart_fully_distributed">搭建分布式的HBase集群</a><br><a target="_blank" rel="noopener" href="https://hbase.apache.org/book.html#zookeeper">HBase使用已经存在的ZooKeeper</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fmgao-technology/p/10416542.html">HBase数据模型和读写原理</a></p></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="HBase集群的搭建和使用">https://www.nosuchfield.com/2021/04/15/HBase-cluster-build-and-use/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" rel="tag">分布式系统</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>