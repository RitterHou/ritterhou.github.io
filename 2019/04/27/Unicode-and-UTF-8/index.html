<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Unicode与UTF-8 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="编码,编程语言"><meta name="description" content="&lt;h3 id=&#34;计算机编码发展的历史&#34;&gt;&lt;a href=&#34;#计算机编码发展的历史&#34; class=&#34;headerlink&#34; title=&#34;计算机编码发展的历史&#34;&gt;&lt;/a&gt;计算机编码发展的历史&lt;/h3&gt;&lt;p&gt;关于计算机系统中编码的历史（例如ASCII、GBK这些编码等等）就不介绍了，如果感兴趣可以看看知乎上面的&lt;a href=&#34;https://www.zhihu.com/question/23374078/answer/69732605&#34;&gt;这个回答&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&#34;Unicode字符集&#34;&gt;&lt;a href=&#34;#Unicode字符集&#34; class=&#34;headerlink&#34; title=&#34;Unicode字符集&#34;&gt;&lt;/a&gt;Unicode字符集&lt;/h3&gt;&lt;p&gt;Unicode(Universal Multiple-Octet Coded Character Set)是由ISO提出的，这是一种旨在包含目前世界上所有文化、所有字母的字符编码表，其目的是世界上任意一个字符都可以在该表中找到其所对应的编码值。Unicode字符集兼容ASCII码中的 0 ~ 127 位字符，对于这些字符Uni"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">Unicode与UTF-8</h1></div><div class="post-meta"><span class="post-time">2019-04-27</span></div><div class="post-content"><h3 id="计算机编码发展的历史"><a href="#计算机编码发展的历史" class="headerlink" title="计算机编码发展的历史"></a>计算机编码发展的历史</h3><p>关于计算机系统中编码的历史（例如ASCII、GBK这些编码等等）就不介绍了，如果感兴趣可以看看知乎上面的<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/23374078/answer/69732605">这个回答</a>。</p><h3 id="Unicode字符集"><a href="#Unicode字符集" class="headerlink" title="Unicode字符集"></a>Unicode字符集</h3><p>Unicode(Universal Multiple-Octet Coded Character Set)是由ISO提出的，这是一种旨在包含目前世界上所有文化、所有字母的字符编码表，其目的是世界上任意一个字符都可以在该表中找到其所对应的编码值。Unicode字符集兼容ASCII码中的 0 ~ 127 位字符，对于这些字符Unicode会将其ASCII码值放在低位，高位全部置为零。</p><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84">Unicode字符平面映射</a>把Unicode分为17个平面（Plane），每个平面拥有 <code>2 ^ 16 = 65536</code> 个代码点，即每个平面可以表示65536个字符。这17个平面的范围如下表：</p><table><thead><tr><th>平面</th><th>编码取值范围</th></tr></thead><tbody><tr><td>0号平面</td><td>U+0000 - U+FFFF</td></tr><tr><td>1号平面</td><td>U+10000 - U+1FFFF</td></tr><tr><td>2号平面</td><td>U+20000 - U+2FFFF</td></tr><tr><td>3号平面</td><td>U+30000 - U+3FFFF</td></tr><tr><td>4号平面 - 13号平面</td><td>U+40000 - U+DFFFF</td></tr><tr><td>14号平面</td><td>U+E0000 - U+EFFFF</td></tr><tr><td>15号平面</td><td>U+F0000 - U+FFFFF</td></tr><tr><td>16号平面</td><td>U+100000 - U+10FFFF</td></tr></tbody></table><p>作为使用者，我们并不需要了解Unicode是如何设计并对字符进行分类的，我们只需要知道在Unicode中<strong>一个字符对应了一个唯一的编码</strong>就可以了，这个唯一编码叫做<code>code point</code>，其实就是该字符在编码表中的位置下标。</p><h3 id="utf-8编码"><a href="#utf-8编码" class="headerlink" title="utf-8编码"></a>utf-8编码</h3><p>utf-8是Unicode的一种变长度的编码表达方式，Unicode字符集中有相当多的字符其编码高位都是零，这浪费了很多的空间。为了节省空间，可以<strong>使用utf-8编码方式对Unicode做进一步的编码</strong><sup>注1</sup>。相较于Unicode，使用utf-8编码可以显著的减少字符的空间占用。</p><p>utf-8对Unicode编码值小于U+FFFF的字符编码效率较高，而对于高于U+FFFF的字符值使用utf-16编码可能是个更好的选择，好在我们常用的字符其编码值基本上都不会超过U+FFFF，所以一般来说utf-8编码方式已经足够满足我们的需求。不过事实上，假设不使用utf-8或者utf-16等编码方式，而是<strong>直接使用Unicode编码加上使用数据压缩算法（例如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/DEFLATE">DEFLATE</a>）</strong>的方式，也能得到较好的空间节省效果。</p><p>我们已经知道了引入utf-8编码机制的目的是为了减少空间的占用，下面我们就详细了解一下utf-8的编码方式。如下是一个utf-8编码与Unicode编码的关系表</p><table><thead><tr><th>位数</th><th>Unicode范围</th><th>字节数</th><th>字节1</th><th>字节2</th><th>字节3</th><th>字节4</th></tr></thead><tbody><tr><td>7</td><td>U+0000 - U+007F</td><td>1</td><td>0xxxxxxx</td><td></td><td></td><td></td></tr><tr><td>11</td><td>U+0080 - U+07FF</td><td>2</td><td>110xxxxx</td><td>10xxxxxx</td><td></td><td></td></tr><tr><td>16</td><td>U+0800 - U+FFFF</td><td>3</td><td>1110xxxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td></td></tr><tr><td>21</td><td>U+10000 - U+1FFFFF</td><td>4</td><td>11110xxx</td><td>10xxxxxx</td><td>10xxxxxx</td><td>10xxxxxx</td></tr></tbody></table><p>上面只列举了utf-8编码在4个字节以内的编码方式，再多的因为很少使用没有列举出来。上表中的 <code>x</code> 代表了utf-8编码中的编码值，可以根据字符计算得到。</p><p>根据上表我们可以得到utf-8编码四种情况：</p><ol><li>第一个bit为0，则说明这个字符只占用一个字节，字符的值为后7个bit</li><li>前三个bit为110，则说明这个字符占用两个字节，字符的值为第一个字节的后5个bit加上第二个字节的后6个bit</li><li>前四个bit为1110，该字符占用三个字节，字符的值为 字节一[4:] + 字节二[2:] + 字节三[2:]</li><li>前五个bit为11110，该字符占用四个字节，字符的值为 字节一[5:] + 字节二[2:] + 字节三[2:] + 字节四[2:]</li></ol><p>下面我们看一个实际的utf-8和unicode相互转化的例子：</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将输入的utf-8字符依次转化为其unicode</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">utf8ToUnicode</span><span class="params">(words <span class="type">string</span>)</span></span> ([]<span class="type">uint32</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 对字节做移位处理。基础字节，andByte用于剔除无用的bit，leftMoveBit代表左移位数</span></span><br><span class="line">	cal := <span class="function"><span class="keyword">func</span><span class="params">(baseByte <span class="type">byte</span>, andByte <span class="type">byte</span>, leftMoveBit <span class="type">uint32</span>)</span></span> <span class="type">uint32</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="type">uint32</span>(baseByte&amp;andByte) &lt;&lt; leftMoveBit</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	bytes := []<span class="type">byte</span>(words)</span><br><span class="line">	offset := <span class="number">0</span></span><br><span class="line">	length := <span class="built_in">len</span>(bytes)</span><br><span class="line"></span><br><span class="line">	unicodeList := <span class="built_in">make</span>([]<span class="type">uint32</span>, <span class="number">0</span>) <span class="comment">// 存储最终的unicode列表</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> offset &lt; length &#123;</span><br><span class="line">		<span class="keyword">var</span> codePoint <span class="type">uint32</span>      <span class="comment">// 字符集中的字符位置下标，即unicode码</span></span><br><span class="line">		codeUnit := bytes[offset] <span class="comment">// 最小编码单位，即第一个byte</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 下面这段代码比较机械，参考上面的编码表即可理解</span></span><br><span class="line">		<span class="keyword">if</span> codeUnit&gt;&gt;<span class="number">7</span> == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">// 一个字节</span></span><br><span class="line">			codePoint = <span class="type">uint32</span>(codeUnit)</span><br><span class="line">			offset += <span class="number">1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> codeUnit&gt;&gt;<span class="number">5</span> == <span class="number">0x6</span> &#123;</span><br><span class="line">			<span class="comment">// 两个字节</span></span><br><span class="line">			codePoint = cal(bytes[offset], <span class="number">0x1f</span>, <span class="number">6</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">1</span>], <span class="number">0x3f</span>, <span class="number">0</span>)</span><br><span class="line">			offset += <span class="number">2</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> codeUnit&gt;&gt;<span class="number">4</span> == <span class="number">0xe</span> &#123;</span><br><span class="line">			<span class="comment">// 三个字节</span></span><br><span class="line">			codePoint = cal(bytes[offset], <span class="number">0xf</span>, <span class="number">12</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">1</span>], <span class="number">0x3f</span>, <span class="number">6</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">2</span>], <span class="number">0x3f</span>, <span class="number">0</span>)</span><br><span class="line">			offset += <span class="number">3</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> codeUnit&gt;&gt;<span class="number">3</span> == <span class="number">0x1e</span> &#123;</span><br><span class="line">			<span class="comment">// 四个字节</span></span><br><span class="line">			codePoint = cal(bytes[offset], <span class="number">0x7</span>, <span class="number">18</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">1</span>], <span class="number">0x3f</span>, <span class="number">12</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">2</span>], <span class="number">0x3f</span>, <span class="number">6</span>) +</span><br><span class="line">				cal(bytes[offset+<span class="number">3</span>], <span class="number">0x3f</span>, <span class="number">0</span>)</span><br><span class="line">			offset += <span class="number">4</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;非法的utf-8字符&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		unicodeList = <span class="built_in">append</span>(unicodeList, codePoint)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> unicodeList, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将输入的unicode转化为其对应的utf-8编码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unicodeToUtf8</span><span class="params">(code <span class="type">uint32</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	bytes := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="comment">// 同样是一段很机械的代码，实现参考上面的编码表</span></span><br><span class="line">	<span class="keyword">if</span> code &lt; <span class="number">0x80</span> &#123;</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code)&amp;<span class="number">0x7f</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> code &lt; <span class="number">0x800</span> &#123;</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">6</span>)&amp;<span class="number">0x1f</span>|<span class="number">0xc0</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> code &lt; <span class="number">0x10000</span> &#123;</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">12</span>)&amp;<span class="number">0xf</span>|<span class="number">0xe0</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">6</span>)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> code &lt; <span class="number">0x20000</span> &#123;</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">18</span>)&amp;<span class="number">0x7</span>|<span class="number">0xf0</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">12</span>)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code&gt;&gt;<span class="number">6</span>)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">		bytes = <span class="built_in">append</span>(bytes, <span class="type">byte</span>(code)&amp;<span class="number">0x3f</span>|<span class="number">0x80</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(fmt.Sprintf(<span class="string">&quot;0x%x can&#x27;t be convert to utf-8&quot;</span>, code))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> bytes, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	testSet := <span class="string">&quot;Ƞ南京👉上海12aA北京の𐀉☺©🐵😆😄Ⅷ🖤&quot;</span> <span class="comment">// golang默认使用utf-8对源代码文件进行编码</span></span><br><span class="line">	unicodeList, _ := utf8ToUnicode(testSet)</span><br><span class="line">	<span class="keyword">for</span> _, unicode := <span class="keyword">range</span> unicodeList &#123;</span><br><span class="line">		result, err := unicodeToUtf8(unicode)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;0x%x %s\n&quot;</span>, unicode, <span class="type">string</span>(result))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>utf-8作为现在最广泛使用的编码方式，了解一下其工作原理还是有必要的。utf-8离不开unicode，utf-8编码出现的目的是为对unicode的编码值进行压缩，这才是utf-8编码的最核心意义。</p><h3 id="注"><a href="#注" class="headerlink" title="注"></a>注</h3><ol><li>这里有点绕，Unicode和utf-8都是编码方式，我们可以这样对它们作区分：<ul><li>Unicode是一种表驱动的编码方式，即编码值是通过查表的方式获得的</li><li>utf-8是一种通过计算而编码的方式，我们可以通过计算来实现一个字符的utf-8编码与Unicode编码的相互转化</li></ul></li></ol><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="http://cenalulu.github.io/linux/character-encoding/">十分钟搞清字符集和字符编码</a><br><a target="_blank" rel="noopener" href="http://zablog.me/2017/09/18/emoji/">Emoji与Unicode</a></p></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="Unicode与UTF-8">https://www.nosuchfield.com/2019/04/27/Unicode-and-UTF-8/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">编码</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag">编程语言</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>