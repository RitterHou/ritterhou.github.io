<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Maven详细介绍 - 侯锐的思考与分享</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="keywords" content="编译,Java"><meta name="description" content="&lt;p&gt;maven是一个声明式的Java程序构建工具，最开始人们使用make命令搭配makefile脚本实现构建过程，tomcat的作者认为make命令不跨平台且脚本编写复杂，因此发明了Ant(Another Neat Tool)。Ant解决了make命令不跨平台且脚本编写困难的问题，不过Ant依然是过程式的，每一个使用Ant的用户仍然需要编写自己所需要的一系列脚本。&lt;/p&gt;
&lt;p&gt;maven通过定义了一系列的标准，让用户基本不再需要自己编写脚本，只需要按照maven暴露出的简单标准接口实现构建操作。这样既可以降低用户使用的复杂度，也能够定义一套统一的标准，当用户接手一个全新的项目时，可以根据已知的标准快速上手。&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;&lt;a href=&#34;#安装&#34; class=&#34;headerlink&#34; title=&#34;安装&#34;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;p&gt;maven的安装很简单，只需要下载压缩包解压到磁盘上，并将&lt;code&gt;MAVEN根目录/bin&lt;/code&gt;添加到&lt;code&gt;PATH&lt;/code&gt;中方便使用&lt;code&gt;mvn&lt;/code&gt;命令。自&lt;a href=&#34;https://"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="侯锐的思考与分享" type="application/atom+xml"></head><body><div class="container"><header class="header"><div class="blog-title"><a href="/" class="logo">侯锐的思考与分享</a><div class="subtitle"></div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link" data-no-instant>主页</a></li><li class="menu-item"><a href="/atom.xml" class="menu-item-link" data-no-instant>订阅</a></li><li class="menu-item"><a href="/search" class="menu-item-link" data-no-instant>搜索</a></li></ul></nav></header><article class="post"><div class="post-title"><h1 class="article-title">Maven详细介绍</h1></div><div class="post-meta"><span class="post-time">2023-06-16</span></div><div class="post-content"><p>maven是一个声明式的Java程序构建工具，最开始人们使用make命令搭配makefile脚本实现构建过程，tomcat的作者认为make命令不跨平台且脚本编写复杂，因此发明了Ant(Another Neat Tool)。Ant解决了make命令不跨平台且脚本编写困难的问题，不过Ant依然是过程式的，每一个使用Ant的用户仍然需要编写自己所需要的一系列脚本。</p><p>maven通过定义了一系列的标准，让用户基本不再需要自己编写脚本，只需要按照maven暴露出的简单标准接口实现构建操作。这样既可以降低用户使用的复杂度，也能够定义一套统一的标准，当用户接手一个全新的项目时，可以根据已知的标准快速上手。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>maven的安装很简单，只需要下载压缩包解压到磁盘上，并将<code>MAVEN根目录/bin</code>添加到<code>PATH</code>中方便使用<code>mvn</code>命令。自<a target="_blank" rel="noopener" href="https://maven.apache.org/docs/3.5.0/release-notes.html">maven 3.5</a>之后已经不再需要设置<code>JAVA_HOME</code>和<code>M2_HOME</code>环境变量了，同时建议使用手动安装的maven替换idea中的bundle maven。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mvn -v</span></span><br><span class="line">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)</span><br><span class="line">Maven home: D:\apache-maven-3.3.9-bin\apache-maven-3.3.9</span><br><span class="line">Java version: 1.8.0_291, vendor: Oracle Corporation</span><br><span class="line">Java home: C:\Program Files\Java\jdk1.8.0_291\jre</span><br><span class="line">Default locale: en_US_US, platform encoding: GBK</span><br><span class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;dos&quot;</span><br></pre></td></tr></table></figure><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p>和Make的Makefile、Ant的build.xml一样，maven的核心是pom.xml，POM（Project Object Model，项目对象模型）描述了项目的详细信息。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>service<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>example<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>例如针对如上的一个pom.xml配置文件，第一行定义了文件的版本和编码，紧接着的就是project元素，它声明了一些描述信息以方便编辑工具检查XML文件的格式。project元素包含了一些子元素，它们的含义如下</p><table><thead><tr><th align="left">元素</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">modelVersion</td><td align="left">POM的版本，对于Maven 2和Maven 3这个值为4.0.0</td></tr><tr><td align="left">groupId</td><td align="left">项目所属的组织</td></tr><tr><td align="left">artifactId</td><td align="left">项目在组织中的名称</td></tr><tr><td align="left">version</td><td align="left">项目的版本</td></tr><tr><td align="left">name</td><td align="left">项目的可读名称，非必须</td></tr><tr><td align="left">description</td><td align="left">项目的描述，非必须</td></tr></tbody></table><p>maven提供了一个叫做<code>archetype</code>的插件，这个插件是一个创建maven项目的脚手架工具。我们可以使用<code>help</code>插件的<code>describe</code> goal来查看这个插件的详细信息</p><pre><code>mvn help:describe -Dplugin=archetype
</code></pre><p>查看描述信息可以知道<code>archetype</code>插件有一个<code>generate</code>的goal，可以使用这个goal创建maven项目</p><pre><code>mvn archetype:generate
</code></pre><h2 id="maven坐标"><a href="#maven坐标" class="headerlink" title="maven坐标"></a>maven坐标</h2><p>maven将依赖通过一些属性的定义管理起来，就如同地理上确定一个位置需要经纬度一样，maven中确定一个依赖需要一下几个属性</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure><p>前三个属性必须设置，packaging是可选的，默认为jar。当maven项目需要依赖其它项目的时候，一般可以有如下配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span><span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span><span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span><span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span><span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>groupId、artifactId和version代表依赖的基本坐标，而type默认为jar。</p><h3 id="scope（依赖范围）"><a href="#scope（依赖范围）" class="headerlink" title="scope（依赖范围）"></a>scope（依赖范围）</h3><p>maven在编译项目时会使用一个classpath，在测试项目的时候会使用另一个classpath，而最终打包的结果在运行业务的时候也会使用一个自己的classpath。这对应了依赖的scope的三个选项</p><h4 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h4><p>如果不指定就使用compile选项，代表编译依赖范围。使用这个配置的依赖范围的maven依赖，在编译、测试和运行的时候这个依赖都有效。例如spring-code</p><h4 id="test"><a href="#test" class="headerlink" title="test"></a>test</h4><p>测试依赖范围，这些依赖只对测试classpath有效。例如JUint</p><h4 id="provided"><a href="#provided" class="headerlink" title="provided"></a>provided</h4><p>已提供依赖范围，对编译和测试classpath有效，对运行时classpath无效。例如servlet-api，运行时tomcat会提供</p><h3 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h3><p>运行时依赖范围，对测试和运行classpath有效，对编译时无效。例如JDBC驱动，代码编译的时候只需要接口，实现只在真正运行时才需要。即SPI（Service Provider Interface）机制下常用。</p><h3 id="传递性依赖"><a href="#传递性依赖" class="headerlink" title="传递性依赖"></a>传递性依赖</h3><p>maven会对依赖的依赖进行依赖，即传递性依赖。例如A依赖B，B依赖C，则A也会依赖C。传递依赖存在优先级的概念：</p><ol><li>如果有多个依赖引用了同一个依赖，则选择最短路径。例如<ol><li>A -&gt; B -&gt; C -&gt; X(1)</li><li>A -&gt; D -&gt; X(2)</li><li>因为X(2)路径更短，选择X(2)</li></ol></li><li>如果路径长度一样，谁先声明就选谁</li></ol><h3 id="可选依赖"><a href="#可选依赖" class="headerlink" title="可选依赖"></a>可选依赖</h3><p>可以通过<code>&lt;optional&gt;&lt;/optional&gt;</code>标签实现可选依赖，例如B项目有依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>那么B项目会正常依赖mysql的包。但是如果此时有A项目依赖了B项目，那么A项目是不会自动依赖mysql包的。A项目如果需要正常依赖mysql，就需要手动引入mysql的依赖才行。</p><h3 id="排除依赖"><a href="#排除依赖" class="headerlink" title="排除依赖"></a>排除依赖</h3><p>如果项目A依赖了B项目，但是却不想引用B项目里面的某个依赖，则可以使用排除依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="版本变量"><a href="#版本变量" class="headerlink" title="版本变量"></a>版本变量</h3><p>如果多个依赖使用了同样的版本，则可以在pom.xml中定义一个版本变量</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">example.version</span>&gt;</span>1.0.15<span class="tag">&lt;/<span class="name">example.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;example.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;example.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;example.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>maven提供了插件dependency来查看依赖的一些信息</p><pre><code>mvn dependency:list
mvn dependency:tree
mvn dependency:analyze
mvn dependency:sources -X
</code></pre><h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><p>maven的仓库分为远程仓库和本地仓库。在以前没有maven仓库的时候，都是从网上下载或者从别人那里拷贝的jar包，把包复制到eclipse的&#x2F;lib文件夹下，并手动将包添加到classpath中。</p><p>maven的包一般按照groupId、artifactId、version的方式管理，例如</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>的依赖就位于<code>com/fasterxml/jackson/core/jackson-core/2.12.3</code>文件夹下。一般来说本地的仓库位于<code>~/.m2/repository</code>文件夹，当然也可以根据<code>~/.m2/settings.xml</code>中的配置修改本地仓库的位置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\maven\repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当依赖在本地仓库不存在时，就会从远程仓库中下载（推荐<a target="_blank" rel="noopener" href="https://www.mvncenter.com/">一个maven依赖搜索网站</a>）。<br>maven的默认远程仓库：<a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a>，也可以在<code>pom.xml</code>中使用其它的远程仓库</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>amh<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>AMH Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.amh-group.com/artifactory/repo<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同样的，可以在<code>pom.xml</code>中配置发布依赖的远程仓库</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases.deploy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Local Nexus Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.amh-group.com/artifactory/libs-release-local<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots.deploy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Local Nexus Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.amh-group.com/artifactory/libs-snapshot-local<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用命令<code>mvn deploy</code>就可以把release或snapshot版本的依赖推到私服上去了。</p><p>maven仓库可以配置镜像，例如如下的镜像配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>就代表了使用阿里云的镜像来替换对central中央仓库的请求。</p><h2 id="生命周期、阶段、目标和插件"><a href="#生命周期、阶段、目标和插件" class="headerlink" title="生命周期、阶段、目标和插件"></a>生命周期、阶段、目标和插件</h2><p>我们在日常软件开发和构建中总会有着一些固定的流程，maven对这些流程做了思考和分析，总结出了三套默认的生命周期（lifecycle），clean、default和site。clean生命周期用于清理项目，default生命周期用于构建项目，site生命周期用于构建项目站点，它们之前相互独立互不影响。</p><p>每个生命周期又由多个阶段（phase）组成，phase的执行有先后顺序的概念。在执行某个phase时，会按顺序从这个lifecycle最开始的phase开始执行，当上一个phase执行完之后会开始继续执行下一个phase，一直执行到当前指定的phase结束。maven的生命周期的阶段如下表</p><h5 id="clean：清理构建输出，包括生成的编译类、JAR文件等"><a href="#clean：清理构建输出，包括生成的编译类、JAR文件等" class="headerlink" title="clean：清理构建输出，包括生成的编译类、JAR文件等"></a>clean：清理构建输出，包括生成的编译类、JAR文件等</h5><table><thead><tr><th align="left">阶段</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">pre-clean</td><td align="left">执行一些清理前需要完成的工作</td></tr><tr><td align="left">clean</td><td align="left">清理上一个构建生成的文件</td></tr><tr><td align="left">post-clean</td><td align="left">执行一些清理后需要完成的工作</td></tr></tbody></table><h5 id="default：编译源代码并处理打包项目相关的所有事情"><a href="#default：编译源代码并处理打包项目相关的所有事情" class="headerlink" title="default：编译源代码并处理打包项目相关的所有事情"></a>default：编译源代码并处理打包项目相关的所有事情</h5><table><thead><tr><th align="left">阶段</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">validate</td><td align="left"></td></tr><tr><td align="left">initialize</td><td align="left"></td></tr><tr><td align="left">generate-sources</td><td align="left"></td></tr><tr><td align="left">process-sources</td><td align="left">处理项目主资源文件，将<code>src/main/resources</code>目录内的内容进行变量替换之后复制到输出主classpath目录</td></tr><tr><td align="left">generate-resources</td><td align="left"></td></tr><tr><td align="left">process-resources</td><td align="left"></td></tr><tr><td align="left">compile</td><td align="left">编译项目主源码，编译<code>src/main/java</code>目录内的Java文件到输出主classpath目录</td></tr><tr><td align="left">process-classes</td><td align="left"></td></tr><tr><td align="left">generate-test-sources</td><td align="left"></td></tr><tr><td align="left">process-test-sources</td><td align="left">处理<code>src/test/resources</code>目录的资源</td></tr><tr><td align="left">generate-test-resources</td><td align="left"></td></tr><tr><td align="left">process-test-resources</td><td align="left"></td></tr><tr><td align="left">test-compile</td><td align="left">编译<code>src/test/java</code>并放到classpath中</td></tr><tr><td align="left">process-test-classes</td><td align="left"></td></tr><tr><td align="left">test</td><td align="left">执行单元测试</td></tr><tr><td align="left">prepare-package</td><td align="left"></td></tr><tr><td align="left">package</td><td align="left">将编译好的代码打包成可发布的格式，如jar</td></tr><tr><td align="left">pre-integration-test</td><td align="left"></td></tr><tr><td align="left">integration-test</td><td align="left"></td></tr><tr><td align="left">post-integration-test</td><td align="left"></td></tr><tr><td align="left">verify</td><td align="left"></td></tr><tr><td align="left">install</td><td align="left">将打包后的文件安装到本地仓库</td></tr><tr><td align="left">deploy</td><td align="left">将打包后的文件发布到远程仓库</td></tr></tbody></table><h5 id="site：为项目生成文档"><a href="#site：为项目生成文档" class="headerlink" title="site：为项目生成文档"></a>site：为项目生成文档</h5><table><thead><tr><th align="left">阶段</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">pre-site</td><td align="left">执行生成站点之前需要完成的工作</td></tr><tr><td align="left">site</td><td align="left">生成项目站点文档</td></tr><tr><td align="left">post-site</td><td align="left">执行生成站点之后需要完成的工作</td></tr><tr><td align="left">site-deploy</td><td align="left">将生成的项目站点发布到服务器上</td></tr></tbody></table><p>可以在命令行直接执行maven的phase，例如执行<code>mvn clean</code>将会执行clean生命周期的clean阶段，在clean执行之前pre-clean阶段会先执行。同样的<code>mvn package</code>会执行default生命周期的package阶段，在package阶段执行之前会先执行package阶段之前的阶段。phase也可以组合起来执行，<code>mvn clean package</code>就会先执行clean阶段，之后再执行package阶段。</p><h4 id="插件和目标"><a href="#插件和目标" class="headerlink" title="插件和目标"></a>插件和目标</h4><p>maven的阶段只是一个声明，它不执行任何实际的操作，maven实际的操作都是由目标（goal）来完成的，而goal则是由maven的插件（plugin）实现的，目标也称为MOJO（Maven Old Java Object，与Plain Old Java Object对应）。只需要将插件的某个goal绑定到一个phase，在执行这个phase的时候就会执行这个goal。一个phase可以绑定多个goal，一个插件也可以实现多个不同功能的goal。</p><p><img src="/images/20230616/1.svg"></p><p>如上图，plugin abc分别实现了一些goal，而这些goal可以随意的绑定到指定的阶段上。一个phase可以绑定多个goal，一个goal也可以绑定多个phase。当执行某个phase的时候，其实就是在执行这一系列绑定在phase上的goal。</p><p>上面已经介绍了maven的phase例如clean和package执行方法，我们已经知道执行phase实际上就是在执行绑定在这个phase的goal。事实上，我们也可以直接执行插件的goal而不执行phase，语法如下</p><pre><code>mvn groupId:artifactId:version:goal
</code></pre><p>例如</p><pre><code>mvn org.apache.maven.plugins:maven-clean-plugin:2.5:clean
</code></pre><p>如果是maven官方插件</p><ol><li>可以省略groupId</li><li>还可以省略artifactId中的maven-xxx-plugin，即命名的通用部分。maven官方插件的命名为<code>maven-xxx-plugin</code>，非官方推荐为<code>xxx-maven-plugin</code>。</li><li>如果不使用版本号，会自动使用最新的版本（maven 2.x版本会拉取最新snapshot版本，存在问题，3.x只会拉取最新的release版本）</li><li>因此上面执行goal的命令也可以简化为<code>mvn clean:clean</code></li></ol><p>插件maven-help-plugin的describe目标可以查看phase和plugin的详细信息（<code>-D,--define</code> <em>Define a system property</em>）</p><pre><code>mvn help:describe -Dcmd=clean
mvn help:describe -Dplugin=clean
mvn help:describe -Dplugin=org.apache.maven.plugins:maven-clean-plugin:2.5
mvn help:describe -Dplugin=org.apache.maven.plugins:maven-clean-plugin:2.5 -Dgoal=clean
mvn help:describe -Dplugin=help -Ddetail
mvn help:describe -Dplugin=versions
mvn help:describe -Dplugin=archetype
mvn help:describe -Dplugin=com.ymm:apide-maven-plugin:1.7.5
</code></pre><p>maven默认的phase就已经绑定了一些goal，因此我们可以直接使用maven的阶段而不需要手动声明插件依赖，maven阶段默认绑定的goal如下</p><table><thead><tr><th align="left">阶段</th><th align="left">插件</th><th align="left">goal</th><th align="left">任务</th></tr></thead><tbody><tr><td align="left">clean</td><td align="left">maven-clean-plugin</td><td align="left">clean</td><td align="left">清除已生成的构建文件</td></tr><tr><td align="left">process-resources</td><td align="left">maven-resources-plugin</td><td align="left">resources</td><td align="left">复制主资源至主输出目录</td></tr><tr><td align="left">compile</td><td align="left">maven-compiler-plugin</td><td align="left">compile</td><td align="left">编译主代码至主输出目录</td></tr><tr><td align="left">process-test-resources</td><td align="left">maven-resources-plugin</td><td align="left">testResources</td><td align="left">复制测试资源至测试输出目录</td></tr><tr><td align="left">test-compile</td><td align="left">maven-compiler-plugin</td><td align="left">testCompile</td><td align="left">编译测试代码至测试输出目录</td></tr><tr><td align="left">test</td><td align="left">maven-surefire-plugin</td><td align="left">test</td><td align="left">执行测试用例</td></tr><tr><td align="left">package</td><td align="left">maven-jar-plugin</td><td align="left">jar</td><td align="left">创建项目jar包</td></tr><tr><td align="left">install</td><td align="left">maven-install-plugin</td><td align="left">install</td><td align="left">将项目输出构建安装到本地仓库</td></tr><tr><td align="left">deploy</td><td align="left">maven-deploy-plugin</td><td align="left">deploy</td><td align="left">将项目输出构建安装到远程仓库</td></tr><tr><td align="left">site</td><td align="left">maven-site-plugin</td><td align="left">site</td><td align="left">创建项目站点</td></tr><tr><td align="left">site-deploy</td><td align="left">maven-site-plugin</td><td align="left">deploy</td><td align="left">发布项目站点</td></tr></tbody></table><p>除了已经绑定好的goal，我们在项目中也可以手动将插件的goal绑定到指定phase上</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lc-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">appName</span>&gt;</span>lc-service<span class="tag">&lt;/<span class="name">appName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>all<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如上就是在这个项目中，将插件lc-maven-plugin的名称为<code>all</code>的goal绑定到package这个phase上，当项目执行到package阶段的时候，插件的目标all就会执行。此外，我们还定义了maven插件的配置，设置了appName等参数的值。</p><p>除了上面用到的全局配置外，maven还可以将配置设置在指定的任务上</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>all<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appName</span>&gt;</span>lc-service<span class="tag">&lt;/<span class="name">appName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当然，直接在命令行设置参数也是可以的</p><pre><code>mvn package -DappName=lc-service
</code></pre><h2 id="聚合与继承"><a href="#聚合与继承" class="headerlink" title="聚合与继承"></a>聚合与继承</h2><h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>在项目开发中，我们经常会需要有多个相互配合的模块，例如RPC接口一般就会包含一个需要暴露给客户端的API模块和一个需要部署在服务端的API具体实现模块。如果将这两个模块分开来，那么在开发的时候在每个模块都需要去执行maven相关的操作命令，这显然是很不方便的。</p><p>maven因此提出了模块的聚合概念，我们可以给一些模块定义一个聚合模块，对于这些模块通用的操作，我们都可以在聚合模块中去完成。例如我们有project-api和project-service两个模块，它们的pom.xml分别如下：<br><em>project-api</em></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>project-service</em></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果我们想要同时对它们执行maven的相关操作，我们可以再在它们的同级目录创建一个pom.xml文件，此时的目录结构如下图<br><img src="/images/20230616/2.png"><br>展开子模块可以看到project-api和project-service都是普通的maven模块<br><img src="/images/20230616/3.png"><br>聚合模块的pom.xml配置如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>project-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>project-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>聚合模块的定义和普通模块存在很多一样的地方，例如groupId、artifactId等，但也存在区别。第一个特殊的地方就是<code>packaging</code>，它的值为<code>pom</code>，和之前普通模块的<code>jar</code>不一样。聚合模块的打包方式<code>packaging</code>的值必须为<code>pom</code>，否则就无法正常构建。</p><p>另一个特殊的地方就是元素<code>modules</code>，它包含了多个模块，每个模块都是一个当前聚合模块的子模块，<code>module</code>的值为子模块所在的目录与当前<code>pom.xml</code>文件的相对路径。一般会把子模块和聚合模块的pom.xml放在同一个目录下面，方便进行源码管理。当然，也可以不遵循这个规则，例如如下的一个目录结构，将聚合pom.xml放在一个文件夹里面</p><pre><code>.
|-- project
|   `-- pom.xml
|-- project-api
`-- project-service
</code></pre><p>那么聚合模块的pom.xml中的<code>module</code>的配置就应该如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>../project-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>../project-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br></pre></td></tr></table></figure><p>根据上面创建的模块结构，我们可以直接在project文件夹下面执行maven指令，而不需要再去project-api和project-service目录中重复执行maven命令了。我们执行命令<code>mvn compile</code>可以得到如下输出</p><pre><code>[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:                                                    
[INFO]                                                                         
[INFO] project-api                                                             
[INFO] project-service                                                         
[INFO] project                                                                 
[INFO]                                                                         
[INFO] Reactor Summary:
[INFO]
[INFO] project-api ........................................ SUCCESS [  0.977 s]
[INFO] project-service .................................... SUCCESS [  0.085 s]
[INFO] project ............................................ SUCCESS [  0.001 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.138 s
[INFO] Finished at: 2023-06-13T14:21:59+08:00
[INFO] Final Memory: 14M/207M
[INFO] ------------------------------------------------------------------------
</code></pre><p>可以看到maven分别对project-api和project-service执行了操作，最后对project本身也执行了maven操作。这就是maven聚合功能的好处，如果没有聚合功能，我们也许会创建一个<code>build.sh</code>，在里面定义对多个模块的打包的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd project-api</span><br><span class="line">mvn compile</span><br><span class="line">cd ../project-service</span><br><span class="line">mvn compile</span><br></pre></td></tr></table></figure><p>这种过程式的操作方法更像Ant的操作，而不符合maven的<strong>声明式操作</strong>理念。感谢maven的聚合功能，让我们不再需要去手动编写多模块处理脚本。</p><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>上面提到的聚合是为了避免在每个子模块中重复执行maven操作，是通过聚合模块来操作子模块。而继承的目的，则是通过子模块获取父模块中的配置，防止在子模块中重复的对属性进行配置。</p><p>例如在上面的例子中，两个子模块的groupId和version与父模块中的值都是一样的，这显然是一种重复，因为maven可以在子模块中继承父模块来使用父模块的属性值。所以我们可以修改子模块的pom.xml如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>project-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如上就是设置了api模块继承project模块，这样一来api模块就可以不需要设置自己的groupId和version了。当然，如果子模块需要有自己的groupId或version，也可以显式的进行设置对父模块的值进行覆盖。常见的继承属性如下</p><table><thead><tr><th align="left">属性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">groupId</td><td align="left">项目组ID</td></tr><tr><td align="left">version</td><td align="left">项目版本</td></tr><tr><td align="left">description</td><td align="left">项目的描述信息</td></tr><tr><td align="left">organization</td><td align="left">项目的组织信息</td></tr><tr><td align="left">inception Year</td><td align="left">项目的创建年份</td></tr><tr><td align="left">url</td><td align="left">项目URL地址</td></tr><tr><td align="left">developers</td><td align="left">项目的开发者信息</td></tr><tr><td align="left">contributors</td><td align="left">项目的贡献者信息</td></tr><tr><td align="left">distributionManagement</td><td align="left">项目的部署配置</td></tr><tr><td align="left">issueManagement</td><td align="left">项目的缺陷跟踪系统信息</td></tr><tr><td align="left">ciManagement</td><td align="left">项目的持续集成信息</td></tr><tr><td align="left">scm</td><td align="left">项目的版本控制系统信息</td></tr><tr><td align="left">mailingLists</td><td align="left">项目的邮件列表信息</td></tr><tr><td align="left">properties</td><td align="left">项目的自定义的属性</td></tr><tr><td align="left">dependencies</td><td align="left">项目的依赖配置</td></tr><tr><td align="left">dependencyManagement</td><td align="left">项目的依赖管理配置</td></tr><tr><td align="left">repositories</td><td align="left">项目的仓库配置</td></tr><tr><td align="left">build</td><td align="left">项目的源码目录配置、输出目录配置、插件配置、插件管理配置等</td></tr><tr><td align="left">reporting</td><td align="left">项目的报告输出目录配置、报告插件配置等</td></tr></tbody></table><p>以上的属性都可以让子模块从父模块继承到，需要着重介绍的是dependencies和dependencyManagement属性</p><h4 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h4><p>所有声明在dependencies里的依赖都会被自动引入，并且被所有的子项目继承</p><h4 id="dependencyManagement"><a href="#dependencyManagement" class="headerlink" title="dependencyManagement"></a>dependencyManagement</h4><p>dependencyManagement只是声明依赖，并不会真正的引入。<br>当父模块的某个依赖声明在了dependencyManagement中，如果子项目中没有显式声明此依赖，则子项目是不会引入该依赖的。只有当子项目在dependencies中声明了该依赖，此时该依赖才真正的被子项目依赖了。<br>如果子项目中的依赖没有指定版本号，就会继承父项目中dependencyManagement依赖的版本号，子项目在声明的时候也可以重写自己所需要的版本号。<strong>使用该配置的目的是为了在不把所有的依赖都继承给子模块的情况下，统一所有子模块中某个指定依赖的版本号。</strong><br>一般使用方法就是父模块声明所有用到的依赖的版本号，然后子模块真正的进行依赖且不需要加版本号，这样不同的子模块中使用依赖的版本号都会继承自父模块，保证子模块中版本号的一致。</p><p>类似的，maven也有插件的版本管理机制pluginManagement，用法也类似，在父pom中设置了pluginManagement的相关配置之后，子模块只要在plugin元素下配置相关的groupId和artifactId即可。</p><p><em>提示：Maven在依赖的时候，如果存在有父子关系的包，即使只依赖子jar，也是需要把父的pom推到nexus上面去的。如果只推了子jar而没有推父pom，在依赖的时候会报错。</em></p><p>就像Java的所有类都继承自<code>java.lang.Object</code>类一样，maven所有的pom也是继承自一个pom。它位于<code>M2_HOME/lib/maven-model-builder-x.x.x.jar</code>中，解压这个jar，它位于<code>org/apache/maven/model/pom-4.0.0.xml</code>。maven的继承主要是为了解决两个问题，即<strong>减少重复</strong>和<strong>统一标准</strong>，继承可以让子模块不再需要反复的去声明一些配置，也可以让所有子模块拥有和父模块一样统一的配置。</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>从上面可以看到，maven的聚合和继承是两个不同的东西。聚合是为了将多个模块的执行操作合并成一个，减少重复的命令操作；而继承则是为了让多个模块都使用父模块的配置信息，防止许多重复的配置，例如我们使用spring-boot的时候经常会需要<a target="_blank" rel="noopener" href="https://github.com/spring-guides/gs-spring-boot/blob/c42d4edfec8e704431380b884f5cfed78f17e876/initial/pom.xml#L5-L10">继承一个父模块</a>，这里就只是使用了继承操作而没有使用聚合。</p><p>当然，很多时候聚合和继承也会结合起来一起使用的，更多关于继承和聚合的内容可以参考maven的<a target="_blank" rel="noopener" href="https://maven.apache.org/guides/introduction/introduction-to-the-pom.html">官方文档</a>。</p><h2 id="编写maven插件"><a href="#编写maven插件" class="headerlink" title="编写maven插件"></a>编写maven插件</h2><p>从上面我们已经知道，maven的操作都是由插件实际完成的，有的时候已有的插件不能完成我们所需要的功能，这时候就需要自己编写相关的插件。编写插件的主要步骤如下</p><ol><li>创建一个maven-plugin项目，它也是一个maven项目，只不过它的packaging元素应该是maven-plugin</li><li>为插件编写目标goal，每个插件都应该有一个或者多个goal</li><li>为目标提供配置参数，这些参数可以在使用插件的时候进行配置</li><li>编写代码实现goal的逻辑</li><li>错误处理以及测试</li></ol><p>例如如果我们想要创建一个统计源码行数（line count，lc）的插件，可以使用如下命令创建一个maven插件项目</p><pre><code>mvn archetype:generate \
  -DgroupId=org.example \
  -DartifactId=lc-maven-plugin \
  -DarchetypeGroupId=org.apache.maven.archetypes \
  -DarchetypeArtifactId=maven-archetype-plugin
</code></pre><p>创建完项目后，设置pom.xml如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lc-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>maven-plugin<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Line Count Maven Plugin<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugin-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>maven-plugin-api是开发maven插件必须依赖的核心包，而maven-plugin-annotations是为了能在在项目中使用maven插件开发的注解。其它诸如groupId、artifactId等元素都是很常见的，packaging元素也如之前所说的是maven-plugin。</p><p>接下来我们开始实现插件的goal，一个插件可以有一个或多个goal，每个goal都需要继承<code>org.apache.maven.plugin.AbstractMojo</code>类，并实现其<code>execute()</code>方法，goal的名称由注解<code>org.apache.maven.plugins.annotations.Mojo</code>定义。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mojo(name = &quot;count&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LineCountMojo</span> <span class="keyword">extends</span> <span class="title class_">AbstractMojo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;project&#125;&quot;, readonly = true, required = true)</span>  </span><br><span class="line">    <span class="keyword">protected</span> MavenProject project;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;project.build.sourceDirectory&#125;&quot;, readonly = true, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> File sourceDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(defaultValue = &quot;$&#123;project.build.resources&#125;&quot;, readonly = true, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Resource&gt; resources;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(name = &quot;postfixes&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] postfixes = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上goal的名称就叫做count，而goal的具体逻辑就在<code>execute</code>方法中实现，相关的参数可以使用注解<code>@Parameter</code>引入。参数注解的<code>defaultValue</code>属性可以定义参数的默认值，默认值可以包含与这个项目参数相关的表达式，例如<code>$&#123;project.version&#125;</code>代表项目的版本。更多参数的表达式可以在<a target="_blank" rel="noopener" href="https://maven.apache.org/ref/3.9.2/maven-core/apidocs/org/apache/maven/plugin/PluginParameterExpressionEvaluator.html">这里查到</a>，如<code>$&#123;repositorySystemSession&#125;</code>就代表了项目的本地仓库。就如同之前所说的，可以使用参数<code>-D</code>在命令行中设定系统变量来定义插件参数的值。</p><p>关于maven插件开发更加详细的信息可以<a target="_blank" rel="noopener" href="https://maven.apache.org/guides/plugin/guide-java-plugin-development.html">参考maven官方插件开发文档</a>，完整的插件代码也可以在<a target="_blank" rel="noopener" href="https://github.com/RitterHou/lc-maven-plugin">GitHub上面</a>找到。</p><p>想要使用如上插件，需要先在插件项目执行<code>mvn clean install</code>将项目安装到本地maven仓库，随后在其它的项目中依赖此插件。例如想要将插件绑定到某个maven项目的clean阶段，可以进行如下设置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lc-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">postfixes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">postfix</span>&gt;</span>java<span class="tag">&lt;/<span class="name">postfix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">postfix</span>&gt;</span>xml<span class="tag">&lt;/<span class="name">postfix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">postfix</span>&gt;</span>properties<span class="tag">&lt;/<span class="name">postfix</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">postfixes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>count<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>之后在项目中执行<code>mvn clean</code>就可以看到插件的执行信息了。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5345682/">《Maven实战》</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7033652977973854244">终于把项目构建神器 Maven 捋清楚了~</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jhno1/p/15134057.html">Maven-构建生命周期、阶段、目标</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904110244757517">maven 插件开发实战</a><br><a target="_blank" rel="noopener" href="https://maven.apache.org/guides/plugin/guide-java-plugin-development.html">Guide to Developing Java Plugins</a></p></div><div class="post-copyright"><div><strong>本文链接：</strong> <span title="Maven详细介绍">https://www.nosuchfield.com/2023/06/16/Maven-Details/</span></div><div><strong>版权声明： </strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处！</div></div><style>summary{cursor:pointer;margin-bottom:10px}summary:focus{outline:0}</style><script src="/js/code-enhancer.js"></script><script src="/js/pangu.min.js"></script><script>pangu.spacingPage()</script><script>function backToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script defer src="https://cloud.umami.is/script.js" data-website-id="267e4aaf-8cb5-464d-b16c-89e66283e505"></script><div class="post-footer"><ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E7%BC%96%E8%AF%91/" rel="tag">编译</a></li></ul><span onclick="backToTop()" class="top">返回顶部</span></div></article><footer><span>&copy; 2015 - 2025</span> <span class="author">Raymond</span> <span style="float:right"><span class="upyun">本网站由<a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"> <img src="/images/others/upyun.png"></a>提供CDN加速&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <a class="filing" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备15057335号</a> <a class="github" href="https://github.com/RitterHou" target="_blank">GitHub</a></span></footer></div></body></html>